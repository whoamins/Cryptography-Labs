# Описание DES

Алгоритм шифрования блочный, он перерабатывает 64-битные блоки исходного текста в 64-битные блоки шифрованного текста. Оба текста записывается в бинарном алфавите. В процессе шифрования используется задаваемый с самого начала 64-битный ключ К. 

На самом деле 8 бит ключа К не оказывают никакого воздействия на процесс шифрования, они считаются разделительными (это биты с номерами, кратными 8: 8, 16, 24, 32, 40, 48, 56, 64). По существу, используется только 56 бит ключа К. В процессе шифрования задействованы: S-таблицы, расширение E, перестановка P, начальная перестановка IP. Из ключа К генерируются 16 раундовых ключей К1, К2, ..., К16, каждый по 48 бит. Процесс шифрования включает 16 раундов, использующих последовательно ключи К1, К2, ..., К16.

# Начальная перестановка

На вход каждой из них поступает 64 бита, которые затем переставляются в соответствие с заданными таблицами. Эти перестановки взаимно обратны. Другими словами, 58-й бит на входе начальной перестановке переходит в 1-ую позицию на выходе из нее. А финальная перестановка 1-ый входной бит переведет в 58-ую позицию на выходе из нее.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c75f517c-fda6-460e-aa5e-3b9d9ffdfe28/Untitled.png)

Обе перестановки не имеют никакого значения для криптографии. Причина, почему они включены в DES, не ясна и не указана проектировщиками DES.

**Пример:**

Начальная перестановка:

Входные данные: 

0000000000000010000000000000000000000000000000000000000000000001

Выходные данные:

0000000000000000000000001000000000000000000000000000000000000010

**Пример того, что они взаимно обратные:**

На начальной перестановке, 58 бит встает на первую позицию.

На конечной перестановке, 58 битом является 1

На начальной перестановке, 50 бит встает на вторую позицию

На конечной перестановке, 50 битом является 2.

Т.е. происходит так, на начальной перестановка все шифруется, переставляя первый, второй и так до 64, символ - по таблице.

На первую позицию встает 58й бит, на вторую 50й бит, на третью 42й.

Во время конечной перестановки все наоборот. На 58 позицию встает первый элемент, на 50 позицию встает 2 элемент, на 42 позицию встает 3 элемент.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4b3fd77a-c416-4a0e-9908-e0ca0e504939/Untitled.png)

## Раунды DES. Сеть Фейстеля.

DES использует 16 раундов. Каждый раунд DES применяет сеть Фейстеля, как показано ниже

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6057e420-b631-4e5f-b399-8753510b89e8/Untitled.png)

Раунд принимает блоки Li-1 и Ri-1 от предыдущего раунда (или начального блока перестановки) и создает полублоки Li и Ri для входа в следующий раунд (или конечный блок перестановки). 

# Функция DES

Функция DES с помощью 48-битового ключа зашифровывает 32 самых правых бит Ri-1, что бы на выходе получить 32-битовый результат. Эта функция содержит, как это показано на 4 составляющие: Операция XOR, P-бокс расширения, группу S-боксов и прямой бокс.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5beadafd-d932-477f-ace6-db026669ca93/Untitled.png)

**P-бокс расширения (Расширение Е)** служит для расширения 32-битового блока Ri-1 до 48 битов, что бы согласовать его размер с размером подключа раунда. Блок Ri-1 делится на 8 секция по 4 бита. Каждая секция расширяется до 6 бит путем дублирования.

Таблица P-бокс расширения (Расширения Е)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/54757b8a-7254-46bd-bae7-38444c5f5bb7/Untitled.png)

Первые три бита таблицы являются битами 32, 1, 2 от блока Ri-1. По таблице видно, что 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 28, 29, 32 дублируются. Последние 3 бита - это биты 31, 32, 1 блока Ri-1. 

Пример:

Ri-1 =                  00100000000000100000000000001000
Расширенный = 0001000 и т.д.

Расширенный будет уже 48 бит.

После расширения DES использует XOR над расширенной частью правого полублока Ri-1 и ключом раунда Ki.

После xor’a битами ключа блок из 48 битов делится на 8 последовательных 6-битовых векторов b1,b2,...,b8 каждый из которых заменяется на 4-битовый блок Bj с помощью **S-блоков.**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d6e08da6-1024-4fe6-b90a-b6723e4521c4/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/62b21b87-6b8c-417d-ad66-30c0ff622d9d/Untitled.png)

b1 попадает в S1, b2 попадает в S2 и так далее

Чтобы в S-боксе найти шифрообразование блока, надо:

- Из 1-го и последнего битов блока образовать двоичное число, перевести его в десятичную систему. Это будет номер строки (m).
- Из 2, 3, 4 и 5го бита блока образовать двоичное число, перевести его в десятичную систему. Это будет номер столбца
- Число стоящее в S-боксе на пересечение m-строки и l-столбца, будет Bj.
- Перевести Bj в двоичную систему. Ответ готов.

Пример:

Найти шифрообразование вектора b1 = 101011

Решение: На вход S1-бокса подано число 101011

Номер строки = 3 (11 в бинаре)

Номер столбца = 5 (0101 в бинаре)

По таблице S-блоков находим пересечение 3-ей строки и 5-го столбца - число 6 = 0110

Ответ: 0110 - шифропреобразование для 101011

Таким образом мы получаем 8 4-битовых векторов b’1,b’2,...,b’8, которые опять объединяют в 32-битовый блок.

Далее биты блока перетасовываются в прямом P-боксе на основе заданной таблицы (правила пользования таблицей перестановки старые: 7-ой бит входа станет 2-ым битом выхода).

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c9e2888a-32d7-4ac7-b00f-5a2a89a413fb/Untitled.png)

После 16-раунда DES правый и левый блоки уже не меняются местами, а объединяются в блок R16L16 и подвергаются финальной перестановке IP^-1.

# Генерация ключей

DES создает 16 раундовых ключей Ki по 48 битов из ключа K шифра на 56 битов. Однако, чтобы задать ключ шифра надо среди 56 битов ключа дополнительно вписать 8 битов в позиции 8,16,...,64 для проверки целостности таким образом, что бы каждый байт содержал нечетное число единиц.

Затем делается перестановка ключа по таблице, которая ниже

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5ab48e4f-71eb-4a6f-be01-5146194a49fe/Untitled.png)

Результат преобразования разбивается на два 28-битных блока

Блоки начинаются с определенного числа и уменьшаются на восемь, когда уже не получается отнять, то к первому числу блока C добавляется один и начинаем отнимать заново в блоке D отнимается, а не добавляется.

После определения С и D рекурсивно определяется C(i) и D(i), i = 1...16. Для этого применяется циклический сдвиг влево на один или два бита в зависимости от номера итерации.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5f9b4d2a-3f14-404e-8bd5-ad47d20f6e5e/Untitled.png)

Полученные значения вновь переставляются по таблице.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/756bf725-7762-423d-b0aa-00606b633d9b/Untitled.png)
