# Описание DES

Алгоритм шифрования блочный, он перерабатывает 64-битные блоки исходного текста в 64-битные блоки шифрованного текста. Оба текста записывается в бинарном алфавите. В процессе шифрования используется задаваемый с самого начала 64-битный ключ К. 

На самом деле 8 бит ключа К не оказывают никакого воздействия на процесс шифрования, они считаются разделительными (это биты с номерами, кратными 8: 8, 16, 24, 32, 40, 48, 56, 64). По существу, используется только 56 бит ключа К. В процессе шифрования задействованы: S-таблицы, расширение E, перестановка P, начальная перестановка IP. Из ключа К генерируются 16 раундовых ключей К1, К2, ..., К16, каждый по 48 бит. Процесс шифрования включает 16 раундов, использующих последовательно ключи К1, К2, ..., К16.

# Начальная перестановка

На вход каждой из них поступает 64 бита, которые затем переставляются в соответствие с заданными таблицами. Эти перестановки взаимно обратны. Другими словами, 58-й бит на входе начальной перестановке переходит в 1-ую позицию на выходе из нее. А финальная перестановка 1-ый входной бит переведет в 58-ую позицию на выходе из нее.

![image](https://user-images.githubusercontent.com/66217512/159334800-fcabacc1-83bf-433d-a705-c0d75d953142.png)

Обе перестановки не имеют никакого значения для криптографии. Причина, почему они включены в DES, не ясна и не указана проектировщиками DES.

**Пример:**

Начальная перестановка:

Входные данные: 

0000000000000010000000000000000000000000000000000000000000000001

Выходные данные:

0000000000000000000000001000000000000000000000000000000000000010

**Пример того, что они взаимно обратные:**

На начальной перестановке, 58 бит встает на первую позицию.

На конечной перестановке, 58 битом является 1

На начальной перестановке, 50 бит встает на вторую позицию

На конечной перестановке, 50 битом является 2.

Т.е. происходит так, на начальной перестановка все шифруется, переставляя первый, второй и так до 64, символ - по таблице.

На первую позицию встает 58й бит, на вторую 50й бит, на третью 42й.

Во время конечной перестановки все наоборот. На 58 позицию встает первый элемент, на 50 позицию встает 2 элемент, на 42 позицию встает 3 элемент.

![image](https://user-images.githubusercontent.com/66217512/159334841-5c4ce069-12b8-434f-ace1-17d40d51359f.png)

## Раунды DES. Сеть Фейстеля.

DES использует 16 раундов. Каждый раунд DES применяет сеть Фейстеля, как показано ниже

![image](https://user-images.githubusercontent.com/66217512/159334882-95203e12-4f21-4c95-8681-87197ca9ea67.png)

Раунд принимает блоки Li-1 и Ri-1 от предыдущего раунда (или начального блока перестановки) и создает полублоки Li и Ri для входа в следующий раунд (или конечный блок перестановки). 

# Функция DES

Функция DES с помощью 48-битового ключа зашифровывает 32 самых правых бит Ri-1, что бы на выходе получить 32-битовый результат. Эта функция содержит, как это показано на 4 составляющие: Операция XOR, P-бокс расширения, группу S-боксов и прямой бокс.

![image](https://user-images.githubusercontent.com/66217512/159335025-99d76be5-4ec3-4a41-8328-d24aabef57f3.png)

**P-бокс расширения (Расширение Е)** служит для расширения 32-битового блока Ri-1 до 48 битов, что бы согласовать его размер с размером подключа раунда. Блок Ri-1 делится на 8 секция по 4 бита. Каждая секция расширяется до 6 бит путем дублирования.

Таблица P-бокс расширения (Расширения Е)

![image](https://user-images.githubusercontent.com/66217512/159335077-f99f5313-b548-4acb-ad80-4cbdffdf0894.png)

Первые три бита таблицы являются битами 32, 1, 2 от блока Ri-1. По таблице видно, что 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 28, 29, 32 дублируются. Последние 3 бита - это биты 31, 32, 1 блока Ri-1. 

Пример:

Ri-1 =                  00100000000000100000000000001000
Расширенный = 0001000 и т.д.

Расширенный будет уже 48 бит.

После расширения DES использует XOR над расширенной частью правого полублока Ri-1 и ключом раунда Ki.

После xor’a битами ключа блок из 48 битов делится на 8 последовательных 6-битовых векторов b1,b2,...,b8 каждый из которых заменяется на 4-битовый блок Bj с помощью **S-блоков.**

![image](https://user-images.githubusercontent.com/66217512/159335168-0540a28e-935c-4a0c-9f2b-6ca12029506e.png)

![image](https://user-images.githubusercontent.com/66217512/159335191-4e023bec-ec46-421d-adc9-c153c1768eae.png)

b1 попадает в S1, b2 попадает в S2 и так далее

Чтобы в S-боксе найти шифрообразование блока, надо:

- Из 1-го и последнего битов блока образовать двоичное число, перевести его в десятичную систему. Это будет номер строки (m).
- Из 2, 3, 4 и 5го бита блока образовать двоичное число, перевести его в десятичную систему. Это будет номер столбца
- Число стоящее в S-боксе на пересечение m-строки и l-столбца, будет Bj.
- Перевести Bj в двоичную систему. Ответ готов.

Пример:

Найти шифрообразование вектора b1 = 101011

Решение: На вход S1-бокса подано число 101011

Номер строки = 3 (11 в бинаре)

Номер столбца = 5 (0101 в бинаре)

По таблице S-блоков находим пересечение 3-ей строки и 5-го столбца - число 6 = 0110

Ответ: 0110 - шифропреобразование для 101011

Таким образом мы получаем 8 4-битовых векторов b’1,b’2,...,b’8, которые опять объединяют в 32-битовый блок.

Далее биты блока перетасовываются в прямом P-боксе на основе заданной таблицы (правила пользования таблицей перестановки старые: 7-ой бит входа станет 2-ым битом выхода).

![image](https://user-images.githubusercontent.com/66217512/159335243-4dded0e2-2d06-4305-bd33-26811bb2dbf0.png)

После 16-раунда DES правый и левый блоки уже не меняются местами, а объединяются в блок R16L16 и подвергаются финальной перестановке IP^-1.

# Генерация ключей

DES создает 16 раундовых ключей Ki по 48 битов из ключа K шифра на 56 битов. Однако, чтобы задать ключ шифра надо среди 56 битов ключа дополнительно вписать 8 битов в позиции 8,16,...,64 для проверки целостности таким образом, что бы каждый байт содержал нечетное число единиц.

Затем делается перестановка ключа по таблице, которая ниже

![image](https://user-images.githubusercontent.com/66217512/159335282-e0272aa7-f6a9-4835-b3f9-cd439c8dfd66.png)

Результат преобразования разбивается на два 28-битных блока

Блоки начинаются с определенного числа и уменьшаются на восемь, когда уже не получается отнять, то к первому числу блока C добавляется один и начинаем отнимать заново в блоке D отнимается, а не добавляется.

После определения С и D рекурсивно определяется C(i) и D(i), i = 1...16. Для этого применяется циклический сдвиг влево на один или два бита в зависимости от номера итерации.

![image](https://user-images.githubusercontent.com/66217512/159335325-7aaf0571-efee-47d3-a4dd-e2e6bf1f4443.png)

Полученные значения вновь переставляются по таблице.

![image](https://user-images.githubusercontent.com/66217512/159335348-512c9a62-2efb-4234-8950-786e156411d0.png)
